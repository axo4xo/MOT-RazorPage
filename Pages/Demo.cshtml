@page
@* 
  ========================================
  RAZOR PAGE DEMO - EDITACE ČLÁNKŮ
  ========================================
  
  Scénář:
  1. Seznam článků s tlačítkem "Edituj" (odkaz s ID)
  2. Načtení dat článku podle ID (OnGetEdit handler)
  3. Předvyplnění formuláře daty článku
  4. Odeslání změn přes OnPost (binding na DTO)
  5. Uložení změněných dat
*@
@model DemoModel
@{
    ViewData["Title"] = "Editace článků";
}

<div class="container py-4">
    <h1 class="mb-4">Správa článků</h1>
    <p class="lead">Demonstrace CRUD operací v Razor Pages</p>

    @* ===== ZOBRAZENÍ ZPRÁVY ===== *@
    @if (!string.IsNullOrEmpty(Model.Message))
    {
        <div class="alert alert-info alert-dismissible">
            @Model.Message
        </div>
    }

    <div class="row">
        @* ===== LEVÝ SLOUPEC: SEZNAM ČLÁNKŮ ===== *@
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">1. Seznam článků</h5>
                    @* 
                      Tlačítko pro nový článek
                      asp-page-handler="New" zavolá OnGetNew()
                    *@
                    <a asp-page="/Demo" asp-page-handler="New" class="btn btn-light btn-sm">
                        + Nový článek
                    </a>
                </div>
                <div class="card-body">
                    <p class="text-muted small">
                        Každý článek má tlačítko <strong>Edituj</strong> - 
                        odkaz <code>&lt;a&gt;</code> s ID článku v URL.
                    </p>

                    @* 
                      Seznam článků vykreslený pomocí @foreach
                      Pro každý článek vytvoříme kartu s tlačítkem Edituj
                    *@
                    @foreach (var article in Model.Articles)
                    {
                        <div class="card mb-2">
                            <div class="card-body py-2">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">@article.Title</h6>
                                        <small class="text-muted">Autor: @article.Author</small>
                                    </div>
                                    @* 
                                      KLÍČOVÝ PRVEK: Odkaz s ID článku
                                      asp-page="/Demo" - cílová stránka
                                      asp-page-handler="Edit" - zavolá OnGetEdit(id)
                                      asp-route-id="@article.Id" - předá ID jako parametr
                                      
                                      Výsledná URL: /Demo?handler=Edit&id=1
                                    *@
                                    <a asp-page="/Demo" 
                                       asp-page-handler="Edit" 
                                       asp-route-id="@article.Id" 
                                       class="btn btn-outline-primary btn-sm">
                                        Edituj
                                    </a>
                                </div>
                            </div>
                        </div>
                    }

                    <hr class="my-3"/>
                    
                    <div class="small bg-light p-2 rounded">
                        <strong>Generované URL:</strong><br/>
                        <code>/Demo?handler=Edit&amp;id=1</code>
                    </div>
                </div>
            </div>
        </div>

        @* ===== PRAVÝ SLOUPEC: FORMULÁŘ PRO EDITACI ===== *@
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header @(Model.IsEditing ? "bg-warning" : "bg-secondary text-white")">
                    <h5 class="mb-0">
                        @if (Model.IsEditing)
                        {
                            @(Model.Input.Id > 0 ? $"2. Editace článku #{Model.Input.Id}" : "2. Nový článek")
                        }
                        else
                        {
                            <span>2. Formulář (vyberte článek)</span>
                        }
                    </h5>
                </div>
                <div class="card-body">
                    @if (Model.IsEditing)
                    {
                        @* 
                          FORMULÁŘ S MODEL BINDING
                          method="post" - odešle POST request
                          POST request automaticky zavolá OnPost() handler
                        *@
                        <form method="post">
                            @* 
                              Skryté pole pro ID článku
                              asp-for automaticky:
                              - nastaví type="hidden" (protože je to int a není to výrazně zobrazený)
                              - nastaví name="Input.Id" pro binding
                              - nastaví value na aktuální hodnotu
                            *@
                            <input type="hidden" asp-for="Input.Id"/>

                            <div class="mb-3">
                                <label asp-for="Input.Title" class="form-label">Název článku:</label>
                                @* 
                                  asp-for="Input.Title":
                                  - Vygeneruje name="Input.Title"
                                  - Vygeneruje id="Input_Title"  
                                  - Předvyplní value="..." z modelu
                                  - Při POST se hodnota namapuje zpět do Input.Title
                                *@
                                <input asp-for="Input.Title" class="form-control" placeholder="Zadejte název"/>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Input.Author" class="form-label">Autor:</label>
                                <input asp-for="Input.Author" class="form-control" placeholder="Jméno autora"/>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Input.Content" class="form-label">Obsah:</label>
                                <textarea asp-for="Input.Content" class="form-control" rows="4" placeholder="Text článku..."></textarea>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success">
                                    Uložit změny
                                </button>
                                <a asp-page="/Demo" class="btn btn-outline-secondary">
                                    Zrušit
                                </a>
                            </div>
                        </form>
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">
                            <p>Klikněte na <strong>Edituj</strong> u některého článku<br/>
                            nebo vytvořte <strong>Nový článek</strong>.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    @* ===== SEKCE 3: VYSVĚTLENÍ FLOW ===== *@
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">3. Jak to funguje (Data Flow)</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>GET Request (načtení dat):</h6>
                    <ol class="small">
                        <li>Uživatel klikne na <code>&lt;a asp-page-handler="Edit" asp-route-id="1"&gt;</code></li>
                        <li>Prohlížeč odešle GET na <code>/Demo?handler=Edit&amp;id=1</code></li>
                        <li>ASP.NET zavolá <code>OnGetEdit(int id)</code></li>
                        <li>Handler najde článek a naplní <code>Input</code> (DTO)</li>
                        <li>Formulář se předvyplní díky <code>asp-for</code></li>
                    </ol>
                </div>
                <div class="col-md-6">
                    <h6>POST Request (uložení dat):</h6>
                    <ol class="small">
                        <li>Uživatel vyplní formulář a klikne <strong>Uložit</strong></li>
                        <li>Prohlížeč odešle POST request</li>
                        <li><code>[BindProperty]</code> namapuje data do <code>Input</code></li>
                        <li><code>OnPost()</code> zpracuje data (validace, uložení)</li>
                        <li>Stránka se přerenderuje se zprávou o úspěchu</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    @* ===== SEKCE 4: PŘEHLED TAG HELPERS ===== *@
    <div class="card">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">4. Použité Tag Helpers</h5>
        </div>
        <div class="card-body">
            <table class="table table-sm table-bordered mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Tag Helper</th>
                        <th>Účel</th>
                        <th>Příklad v kódu</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>asp-page</code></td>
                        <td>Cílová Razor stránka</td>
                        <td><code>asp-page="/Demo"</code></td>
                    </tr>
                    <tr>
                        <td><code>asp-page-handler</code></td>
                        <td>Volání konkrétního handleru</td>
                        <td><code>asp-page-handler="Edit"</code> → <code>OnGetEdit()</code></td>
                    </tr>
                    <tr>
                        <td><code>asp-route-*</code></td>
                        <td>Parametry do URL/handleru</td>
                        <td><code>asp-route-id="1"</code> → <code>?id=1</code></td>
                    </tr>
                    <tr>
                        <td><code>asp-for</code></td>
                        <td>Binding na vlastnost modelu</td>
                        <td><code>asp-for="Input.Title"</code></td>
                    </tr>
                    <tr>
                        <td><code>[BindProperty]</code></td>
                        <td>Automatické mapování formuláře</td>
                        <td>Data z POST → <code>Input</code> DTO</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
